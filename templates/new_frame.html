<template>
 
    <style>

        .modal-content {
            width: 350px ; 
            height: auto;
            padding: 20px;
            opacity: 90%;
        }

        .frm-frame{
            display: flex;
            flex-direction: column;
            align-items: center;

        }

        .frm-frame *{
            padding: 8px;
            margin: 10px;
            width: 80%;
        }

        #lblNovoUsuario{
            font-size: 12px;
        }

        #showFoto{display: block;}
        #showTexto{display: none;}

    </style>

    <div class="frm-frame">
       
        Tipo de quadro
        <select id="cmbTipo">
            <option value="0" selected>Foto</option>
            <option value="1">Texto</option>
        </select>
        Cor de Fundo
        <input id="cmbColor" type="color" value="#f0a70a" >

            <div id="showFoto">
                <form id="frmUpload" action="files/upload.php" method='post' enctype='multipart/form-data'>
                    <input  name="up_file" id="up_file"      type="file">
                    <input  type="hidden"  id="hdnAccess"    name="hdnAccess"    value="">
                    <input  type="hidden"  id="hdnColor"     name="hdnColor"     value="">
                    <input  type="hidden"  id="hdnCategory"  name="hdnCategory"  value="">
                </form>
                <button  id="btnUpload"> Upload </button>
                
            </div>

        <div id="showTexto">
            Tamanho da Fonte
            <input  id="cmbFont" type="number" value="15" min="8" max="35" >
            <select id="cmbJustify">
                <option value="center" selected>Centralizado</option>
                <option value="justify">Justificado</option>
                <option value="left">Esquerda</option>
                <option value="right">Direita</option>
                <option value="start">Começo</option>
                <option value="end">Final</option>
            </select>
            <textarea id="edtTexto" cols="40" rows="10"></textarea>
            <button id="btnAdd"> Adicionar </button>
        </div>
        
    </div>

</template>

<script>        

    document.querySelector('#cmbTipo').addEventListener('change',()=>{

        if(document.querySelector('#cmbTipo').value == 0){
            document.querySelector('#showFoto').style = 'display: block;'
            document.querySelector('#showTexto').style = 'display: none;'            
        }else{
            document.querySelector('#showFoto').style = 'display: none;'
            document.querySelector('#showTexto').style = 'display: block;'            
        }

    })

    document.querySelector('#btnAdd').addEventListener('click',()=>{

        const params = new Object;        
            params.category = localStorage.getItem("frame");
            params.content = 'txt';
            params.background = document.querySelector('#cmbColor').value;
            params.justify = document.querySelector('#cmbJustify').value;
            params.font = document.querySelector('#cmbFont').value;
            params.text = document.querySelector('#edtTexto').value;

        const myPromisse = queryDB(params,3)

        btnClose.click();
    })

    
    document.querySelector('#btnUpload').addEventListener('click',()=>{

        document.querySelector('#hdnAccess').value = localStorage.getItem('access');
        document.querySelector('#hdnColor').value  = document.querySelector('#cmbColor').value;
        document.querySelector('#hdnCategory').value  = localStorage.getItem("frame");

        const data = new FormData();        
            data.append("up_file",  document.querySelector('#up_file').files[0]);
            data.append("hdnAccess", localStorage.getItem('access'));
            data.append("hdnColor", localStorage.getItem('access'));
            data.append("hdnCategory", localStorage.getItem('access'));

        const myRequest = new Request("files/upload.php",{
            method : "POST",
            body : data
        });

        const myPromisse = new Promise((resolve,reject) =>{
            fetch(myRequest)
            .then(function (response){
                if (response.status === 200) { 
                    resolve(response.text());
                    btnClose.click();
                } else { 
                    reject(new Error("Houve algum erro na comunicação com o servidor"));                    
                } 
            });
        }); 

        myPromisse.then((resolve)=>{
            if(resolve == 1){

                filename = document.querySelector('#up_file').value.split('\\')
                filename = filename[filename.length-1] 

                const params = new Object;        
                    params.category = localStorage.getItem("frame");
                    params.content = 'pic';
                    params.background = document.querySelector('#cmbColor').value;
                    params.filename = filename;
                    params.justify = document.querySelector('#cmbJustify').value;
                    params.font = document.querySelector('#cmbFont').value;

                const myPromisse = queryDB(params,3)

            }else{
                console.log('NO')
            }

            btnClose.click();

//            console.log(resolve)

        })
    })



</script>    