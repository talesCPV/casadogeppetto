<template>
 
    <style>

        .modal-content {
            width: 350px ; 
            height: auto;
            padding: 20px;
            opacity: 90%;
        }

        .frm-frame{
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .frm-frame *{
            padding: 8px;
            margin: 10px;
            width: 80%;
        }

        #lblNovoUsuario{
            font-size: 12px;
        }

    </style>

    <div class="frm-frame">
       
        Imagem
        <input  name="up_file" id="up_file"   type="file"      accept=".jpg,.jpeg,.png">

        Cor de Fundo
        <input id="cmbColor" type="color" value="#f0a70a" >
            
        Fonte
        <input  id="cmbFont" type="number" value="15" min="8" max="35" maxlength="255" >

        Texto
        <textarea id="edtTexto" cols="40" rows="5"></textarea>
        <button id="btnAdd"> Adicionar </button>
        
    </div>

</template>

<script>        
    document.querySelector('#btnAdd').addEventListener('click',()=>{

        document.querySelector('#hdnAccess').value = localStorage.getItem('access');

        const up_data = new FormData();        
            up_data.append("up_file",  document.querySelector('#up_file').files[0]);
            up_data.append("hdnAccess", localStorage.getItem('access'));

        const myRequest = new Request("files/upload.php",{
            method : "POST",
            body : up_data
        });

        const myPromisse = new Promise((resolve,reject) =>{
            fetch(myRequest)
            .then(function (response){
                if (response.status === 200) { 
                    resolve(response.text());
                    btnClose.click();
                } else { 
                    reject(new Error("Houve algum erro na comunicação com o servidor"));                    
                } 
            });
        }); 

        myPromisse.then((resolve)=>{

            const params = new Object;        
            params.category = localStorage.getItem("frame");
            params.background = document.querySelector('#cmbColor').value;
            if(resolve == 1){
                params.content = 'pic';
                filename = document.querySelector('#up_file').value.split('\\')
                params.filename = filename[filename.length-1] 

            }else{
                params.content = 'txt';
                params.filename = ''
            }
            params.font = document.querySelector('#cmbFont').value;
            params.text = document.querySelector('#edtTexto').value;

            const myPromisse = queryDB(params,3)

            myPromisse.then(()=>{
                loadContent(localStorage.getItem("frame"));
            })
            
            btnClose.click();

        })
    })

</script>    