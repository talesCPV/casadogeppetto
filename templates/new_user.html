<template>
 
    <style>

        .frm-login{
            display: flex;
            flex-direction: column;
            align-items: center;

        }

        .frm-login *{
            padding: 8px;
            margin: 10px;
            width: 80%;
        }

        #lblNovoUsuario{
            font-size: 12px;
        }

    </style>

    <div class="frm-login">
       
        <input type="text"     id="edtNome" placeholder="Nome Completo" maxlength="50">
        <input type="text"     id="edtUser" placeholder="Usuário" maxlength="15">
        <input type="password" id="edtPass" placeholder="Senha" maxlength="12" >
        <input type="password" id="edtRepPass" placeholder="Repita a Senha" maxlength="12" >
        <input type="email"    id="edtEmail" placeholder="Email" maxlength="70">
        <input type="text"     id="edtCel" placeholder="Celular" maxlength="15">
        <select id="cmbAccess">
            <option value="1">Cliente</option>
            <option value="10">Administrador</option>
        </select>
        <button id="btnNovo"> Cadastrar </button>
        <button id="btnDel" style="display:none;">Deletar</button>        
        
    </div>

</template>

<script>        

    function repass(){

        A = document.querySelector('#edtPass').value
        B = document.querySelector('#edtRepPass').value

        return (A == B && A.trim() != '') ? true : false
    }

    if(modal_data != ''){
        document.querySelector('#edtNome').value = modal_data.nome
        document.querySelector('#edtUser').value = modal_data.username
        document.querySelector('#edtEmail').value = modal_data.email
        document.querySelector('#edtCel').value = modal_data.cel
        document.querySelector('#cmbAccess').value = modal_data.access
        document.querySelector('#btnNovo').innerHTML = 'Salvar'
        document.querySelector('#btnDel').style = 'display:block;'
    }

    document.querySelector('#btnNovo').addEventListener('click',()=>{

        if(repass()){
            const params = new Object;
                params.username = document.querySelector('#edtUser').value;
                params.hash = document.querySelector('#edtPass').value.getHash(30);
                params.access = document.querySelector('#cmbAccess').value;
                params.cel = document.querySelector('#edtCel').value;
                params.email = document.querySelector('#edtEmail').value;
                params.nome = document.querySelector('#edtNome').value;
            let myPromisse

            if(modal_data != ''){
                params.id = modal_data.id;
                myPromisse = queryDB(params,7)
            }else{
                myPromisse = queryDB(params,1)
            }


        myPromisse.then((resolve)=>{
            btnClose.click();
            openHTML('config.html')
            viewUsers()
        });


//            console.log(modal_data)
        }else{
            alert('Senhas não conferem ou nulas')
        }



//        alert('Novo!!!')

    })

    document.querySelector('#btnDel').addEventListener('click',()=>{
        if (confirm('Deseja realmente deletar este usuário?')) {

            const params = new Object;
                params.id = modal_data.id;

            const myPromisse = queryDB(params,8)
            myPromisse.then((resolve)=>{
                btnClose.click();
                openHTML('config.html')
            });         

        }        
    })


    document.querySelector('#edtCel').addEventListener('keyup',(key)=>{

        phone(key.target)

    })




</script>    